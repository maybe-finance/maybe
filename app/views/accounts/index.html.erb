<% content_for :sidebar do %>
  <%= render "settings/nav" %>
<% end %>

<div class="space-y-4">
  <header class="flex justify-between items-center text-gray-900 font-medium">
    <h1 class="text-xl"><%= t(".accounts") %></h1>
    <div class="flex items-center gap-5">
      <div class="flex items-center gap-2">
        <%= contextual_menu do %>
          <div class="w-48 p-1 text-sm leading-6 text-gray-900 bg-white shadow-lg shrink rounded-xl ring-1 ring-gray-900/5">
            <%= link_to new_institution_path,
                        class: "block w-full py-2 px-3 space-x-2 text-gray-900 hover:bg-gray-50 flex items-center rounded-lg font-normal",
                        data: { turbo_frame: "modal" } do %>
              <%= lucide_icon "building-2", class: "w-5 h-5 text-gray-500" %>
              <span class="text-black"><%= t(".add_institution") %></span>
            <% end %>
          </div>
        <% end %>

        <%= link_to new_account_path,
                    data: { turbo_frame: "modal" },
                    class: "rounded-lg bg-gray-900 text-white flex items-center gap-1 justify-center hover:bg-gray-700 px-3 py-2" do %>
          <%= lucide_icon("plus", class: "w-5 h-5") %>
          <p class="text-sm font-medium"><%= t(".new_account") %></p>
        <% end %>

        <%= button_to sync_all_accounts_path, method: :post, class: "rounded-lg bg-gray-900 text-white flex items-center gap-1 justify-center hover:bg-gray-700 px-3 py-2", title: "Sync All" do %>
          <%= lucide_icon "refresh-cw", class: "w-5 h-5" %>
        <% end %>
      </div>
    </div>
  </header>

  <% if @accounts.empty? && @institutions.empty? %>
    <%= render "empty" %>
  <% else %>
    <div class="space-y-2">
      <% @institutions.each do |institution| %>
        <%= render "institution_accounts", institution: %>
      <% end %>

      <%= render "institutionless_accounts", accounts: @accounts %>
    </div>
  <% end %>

  <div class="flex justify-between gap-4">
    <% if self_hosted? %>
      <%= previous_setting("Self-Hosting", settings_hosting_path) %>
    <% else %>
      <%= previous_setting("Billing", settings_billing_path) %>
    <% end %>
    <%= next_setting("Tags", tags_path) %>
  </div>
</div>
