<%# locals: (form:) %>

<% action = form.object %>
<% rule = action.rule %>
<% action_type = action.executor.type %>

<li data-controller="rule--actions" data-rule--actions-action-executors-value="<%= rule.action_executors.to_json %>" class="flex items-center gap-3">
  <%= form.hidden_field :_destroy, value: false, data: { rule__actions_target: "destroyField" } %>

  <div class="grow flex gap-2 items-center h-full">

    <div class="grow">
      <%= form.select :action_type, rule.action_executors.map { |executor| [ executor.label, executor.key ] }, {}, data: { action: "rule--actions#handleActionTypeChange" } %>
    </div>

    <%= tag.div class: class_names("min-w-1/2 flex items-center gap-2"),
                data: { rule__actions_target: "actionValue" } do %>
      <span class="font-medium uppercase text-xs">to</span>
      <% case action_type
         when "select" %>
        <%= form.select :value, action.options || [], {} %>
      <% when "text" %>
        <%= form.text_field :value, placeholder: "Enter a value", class: "form-field__input" %>
      <% end %>
    <% end %>

  </div>

  <%= icon(
    "trash-2",
    size: "sm",
    as_button: true,
    data: { action: "rule--actions#remove", rule__actions_destroy_param: action.persisted? }) %>
</li>
