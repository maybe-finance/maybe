<div 
  class="p-4 min-w-[600px]" 
  data-controller="rule"
  data-rule-conditions-registry-value="<%= @rule.conditions_registry.to_json %>"
  data-rule-actions-registry-value="<%= @rule.actions_registry.to_json %>"
>
  <%= form_with model: @rule, class: "space-y-8" do |f|%>
    <h2>New <%= @rule.resource_type %> rule</h2>

    <%= f.hidden_field :resource_type, value: @rule.resource_type %>

    <section class="space-y-4">
      <h3 class="mb-4 font-bold">Conditions</h3>
      <hr>

      <template data-rule-target="newConditionTemplate">
        <%= f.fields_for :conditions, @template_condition, child_index: "IDX_PLACEHOLDER" do |cf| %>
          <%= render "rule/conditions/condition_group", condition: cf.object, form: cf, options: @rule.available_conditions %>
        <% end %>
      </template>

      <ul data-rule-target="conditionsList">
        <span>When</span>

        <%= f.fields_for :conditions do |cf| %>
          <%= render "rule/conditions/condition_group", condition: cf.object, form: cf, options: @rule.available_conditions %>
        <% end %>
      </ul>

      <button type="button" data-action="rule#addCondition">Add condition</button>
    </section>

    <section class="space-y-4">
      <h3 class="mb-4 font-bold">Actions</h3>
      <hr>

      <template data-rule-target="newActionTemplate">
        <%= f.fields_for :actions, @template_action, child_index: "IDX_PLACEHOLDER" do |af| %>
          <%= render "rule/actions/action", action: af.object, form: af, options: @rule.available_actions %>
        <% end %>
      </template>

      <ul data-rule-target="actionsList">
        <%= f.fields_for :actions do |af| %>
          <%= render "rule/actions/action", action: af.object, form: af, options: @rule.available_actions %>
        <% end %>
      </ul>

      <button 
        type="button"
        data-action="rule#addAction"
      >
        Add action
      </button>
    </section>

    <%= f.submit %>
  <% end %>
</div>