<% content_for :title, @chat.title %>

<%= turbo_stream_from @chat %>

<div class="mb-6 flex items-center justify-between">
  <h1 class="text-2xl font-semibold"><%= @chat.title %></h1>
  
  <div class="flex items-center gap-2">
    <%= link_to chats_path, class: "py-2 px-4 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium" do %>
      All Chats
    <% end %>
    
    <%= button_to chat_path(@chat), method: :delete, class: "p-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200", data: { turbo_confirm: "Are you sure you want to delete this chat?" } do %>
      <%= icon("trash-2") %>
    <% end %>
  </div>
</div>

<div class="bg-white border border-gray-200 rounded-lg overflow-hidden" data-controller="chat-scroll">
  <div class="h-[500px] overflow-y-auto flex flex-col" id="chat-container" data-chat-scroll-target="container">
    <div id="messages" class="flex flex-col justify-end min-h-full p-4 space-y-4 mt-auto" data-chat-scroll-target="messages">
      <% messages = @messages.where(internal: [false, nil]) %>
      <% if messages.any? %>
        <% messages.each do |message| %>
          <%= render "messages/message", message: message %>
        <% end %>
      <% else %>
        <!-- Show welcome message when chat has no messages -->
        <%= render "layouts/shared/ai_greeting", context: 'chat' %>
      <% end %>
    </div>
  </div>

  <div class="border-t border-gray-200 p-4">
    <%= render "messages/form", chat: @chat, message: @message, scroll_behavior: true %>
  </div>
</div> 